[pytest]
minversion = 7.0
testpaths = tests

python_files = test_*.py
python_classes = Test*
python_functions = test_*

# ====================================================================
# Pytest Configuration
# ====================================================================

# Enable detailed output, coverage reporting, and limited failures
addopts =
    -v
    --tb=short
    --disable-warnings
    --cov=src
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    --maxfail=5
    --durations=10

# ====================================================================
# Custom Test Markers
# ====================================================================

markers =
    slow: marks tests as slow
    integration: marks integration tests
    unit: marks unit tests
    performance: marks performance tests
    security: marks security-related tests
    api: marks API endpoint tests
    ui: marks Streamlit UI component tests
    model: marks ML model tests
    database: marks database-related tests
    external: marks external service tests
    e2e: marks end-to-end Playwright browser tests
    smoke: marks lightweight functional sanity tests

# ====================================================================
# Logging and Async Behavior
# ====================================================================

log_cli = true
log_cli_level = INFO
asyncio_mode = auto

# ====================================================================
# Warning Filters
# ====================================================================

filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore:missing ScriptRunContext
    ignore:Session state does not function when running a script without `streamlit run`

# ====================================================================
# Environment Variables for Test Stability
# ====================================================================

env =
    PYTHONWARNINGS=ignore
    STREAMLIT_HEADLESS=true
    STREAMLIT_TEST_MODE=true
    TESTING=true

# ====================================================================
# Playwright Integration Defaults
# ====================================================================

[tool:pytest]
playwright_browser = chromium
playwright_headless = true
